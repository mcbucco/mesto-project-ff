(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-19",headers:{authorization:"a3298925-26aa-460c-a193-8527045c2876","Content-Type":"application/json"}},t=function(e,t){return fetch(e,t).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n=document.querySelector("#card-template").content;function r(e,t,r,o,c,a,u,i,l,s){var d=n.cloneNode(!0),p=d.querySelector(".card__delete-button"),_=d.querySelector(".card__like-button"),m=d.querySelector(".card__like-counter"),f=d.querySelector(".card__image"),v=d.querySelector(".card"),y=r;return d.querySelector(".card__title").textContent=o,f.src=c,f.alt=a,m.textContent=u,f.addEventListener("click",(function(){return l({name:o,link:c})})),_.addEventListener("click",(function(){return s({likeButton:_,cardID:y,likeCounter:m})})),e?p.addEventListener("click",(function(){return i({card:v,cardID:y})})):p.remove(),t&&_.classList.add("card__like-button_is-active"),d}function o(n){var r;n.card.remove(),r=n.cardID,t("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then(console.log("".concat(r," deleted")))}function c(n){var r;n.likeButton.classList.contains("card__like-button_is-active")?(r=n.cardID,t("".concat(e.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:e.headers})).then((function(e){n.likeCounter.textContent=e.likes.length,console.log("disliked")})):function(n){return t("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers})}(n.cardID).then((function(e){n.likeCounter.textContent=e.likes.length,console.log("liked")})),n.likeButton.classList.toggle("card__like-button_is-active")}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function i(e){e.target===e.currentTarget&&u(e.target)}function l(e){"Escape"===e.key&&u(document.querySelector(".popup_is-opened"))}function s(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){return p(e,n,t.inputErrorClass,t.errorClass)})),d(n,r,t.inactiveButtonClass)}function d(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled="true",t.classList.add(n))}function p(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),o.textContent="",o.classList.remove(r)}var _,m,f,v,y,h,b,S=document.querySelector(".profile__title"),k=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),g=document.querySelector(".profile__edit-icon"),q=document.querySelector(".popup_type_new-avatar"),E=document.forms["new-avatar"],L=E.elements["avatar-link"],x=document.querySelector(".places__list"),B=document.querySelector(".popup_type_edit"),U=document.querySelector(".profile__edit-button"),w=document.forms["edit-profile"],D=w.elements.name,A=w.elements.description,T=document.forms["new-place"],I=T.elements["place-name"],P=T.elements.link,N=document.querySelector(".profile__add-button"),O=document.querySelector(".popup_type_new-card"),j=document.querySelector(".popup_type_image"),J=j.querySelector(".popup__image"),M=j.querySelector(".popup__caption"),H=document.querySelectorAll(".popup"),V=function(e,t){var n=t.querySelector(".button"),r=n.textContent;n.textContent="Сохранение...",u(e),t.reset(),n.textContent=r};function z(e){a(j),J.src=e.link,J.alt=e.name,M.textContent=e.name}m=(_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}).formSelector,f=_.inputSelector,v=_.submitButtonSelector,y=_.inactiveButtonClass,h=_.inputErrorClass,b=_.errorClass,Array.from(document.querySelectorAll(m)).forEach((function(e){return function(e,t,n,r,o,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);a.forEach((function(t){return t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),c.textContent=o,c.classList.add(r)}(e,t,n,r,t.validationMessage)}(e,t,o,c),d(a,u,r)}))}))}(e,f,v,y,h,b)})),t("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){S.textContent=e.name,k.textContent=e.about,C.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){return console.log(e)})),Promise.all([t("".concat(e.baseUrl,"/users/me"),{headers:e.headers}),t("".concat(e.baseUrl,"/cards"),{headers:e.headers})]).then((function(e){var t=e[0]._id;e[1].forEach((function(e){var n=!1,a=!1;e.owner._id==t&&(n=!0),e.likes.map((function(e){return e._id})).includes(t)&&(a=!0),x.append(r(n,a,e._id,e.name,e.link,e.name,e.likes.length,o,z,c))}))})).catch((function(e){return console.log(e)})),g.addEventListener("click",(function(){return a(q)})),U.addEventListener("click",(function(){var e=B.querySelector("form");a(B),s(e,{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),D.value=S.textContent,A.value=k.textContent})),N.addEventListener("click",(function(){a(O)})),w.addEventListener("submit",(function(n){n.preventDefault();var r=D.value,o=A.value;S.textContent=r,k.textContent=o,function(n,r){t("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return console.log("profile updated succesfull, new name / about: ".concat(e.name,", ").concat(e.about))})).catch((function(e){return console.log(e)}))}(r,o),V(B,w)})),E.addEventListener("submit",(function(n){var r;n.preventDefault(),(r=L.value,t("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})})).then((function(e){C.style.backgroundImage="url('".concat(e.avatar,"')"),console.log("new avatar id is ".concat(e.avatar))})).catch((function(e){return console.log(e)})),V(q,E)})),T.addEventListener("submit",(function(n){var a,u;n.preventDefault(),(a=I.value,u=P.value,t("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:u})})).then((function(e){var t=r(!0,!1,e._id,e.name,e.link,e.name,e.likes.length,o,z,c);x.prepend(t),console.log("".concat(e._id," added"))})).catch((function(e){return console.log(e)})),s(O.querySelector("form"),{inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),V(O,T)})),function(e){e.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return u(e)})),e.addEventListener("click",i)}))}(H)})();